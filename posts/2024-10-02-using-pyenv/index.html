<!DOCTYPE html>
<html data-theme="light"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta name="description" content="Manage Python version with pyenv">
    <meta name="keywords" content="python, pyenv, environment, tutorial">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
    <link href="/css/main.css" rel="stylesheet"/>
    <title>Using pyenv to manage your Python versions ~ MOK&#39;s Onomatomaniske Kaos</title>
</head>
<body><header data-theme="dark" >
  <span id="header__title">
    MOK&#39;s Onomatomaniske Kaos
  </span>
  <div id="header__subtitle">
        Super Cool
  </div><nav class="site-nav">
  <ul class="main-menu">
    
    <li>
      <a href="/"  data-theme="dark" class="contrast">Home</a>
    </li>
    
    <li>
      <a href="/posts"  data-theme="dark" class="contrast">Posts</a>
    </li>
    
    <li>
      <a href="/about"  data-theme="dark" class="contrast">About</a>
    </li>
    
  </ul>
</nav>
</header>
<div id="content">
<main class=container>
  <div class="grid">
    <div class="article__title">
      <h2>Using pyenv to manage your Python versions</h2>
    </div>

    <div class="article__categories"><span><i class="fa fa-list"></i></span>
      <a class="article__category" href="/categories/python">Python</a>
    </div> 

  </div> 

  
    <div class="article__date">2024-10-02 21:03</div>
  
  <div class="article__author">Morten Kjeldgaard</div>

  <hr />
  <div class="content">
    <p>In this blog post I will explain how I use <code>pyenv</code> to manage my Python installation. The following is only of relevance if you develop Python programs.</p>
<p>Most &ndash; if not all &ndash; Linux distributions come with a system version of Python, and the most important reason to include it as a system package is to run Python code from other packages.</p>
<p>If you develop Python programs you find you&rsquo;ll need to install other Python modules. Many are available as system packages, but far from all. If you search the web, you&rsquo;ll find that people tell you to install those packages using <code>pip</code>, but if you try to do that, you&rsquo;ll find that you aren&rsquo;t allowed to install your own modules to the system version of Python&hellip; for good reason. Another option is to add the <code>--user</code> switch to <code>pip</code>, and that will install the packages somewhere in your <code>~/.local</code> directory hierachy, but that quickly becomes unmanageable as the system version of Python with time is updated, while your user-local version of packages aren&rsquo;t. Or perhaps you&rsquo;ll find you suddenly need multiple versions of Python modules installed.</p>
<h2 id="pyenv-to-the-rescue"><span class="section-num">1</span> Pyenv to the rescue</h2>
<p><code>Pyenv</code> is a system that lets you install your own Python versions, that live in your home directory tree, more explicitly in <code>~/.pyenv</code>. You can install any version of Python, there are actually hundreds of various Python versions you can install using this system. What actually happens when you install something using <code>pyenv</code> is that is fetches the source code, compiles a special version for your machine, and puts it somewhere in <code>~/.pyenv</code>. When you activate Python from now on, it will not (necessarily) invoke the system version of Python, but the one you have installed using <code>pyenv</code>.</p>
<p>But wait&hellip; isn&rsquo;t that an enormous waste of valuable disk space?</p>
<p>Well, it depends on what your needs are. A full installation of Python including a handsome bunch of extra modules might take up 1 Gigabyte of space, but that is no more than many flatpak programs you install take. So if you need it, you need it. Another advantage is that you might want a newer &ndash;or older&ndash; version of Python than the one your distro ships with.</p>
<p>Here, I will not go into how to install <code>pyenv</code>, just go <a href="https://github.com/pyenv/pyenv">here</a> and follow the instructions. Basically, you install the software (which lives in <code>~/.pyenv</code>)  with <code>git</code> and put some shell commands in your <code>.bashrc</code> or <code>.zshrc</code> file to initalize <code>pyenv</code>.</p>
<h2 id="install-your-first-version-of-python"><span class="section-num">2</span> Install your first version of Python</h2>
<p>To see what versions of Python are available, you can now list them all:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv install --list
</span></span></code></pre></div><p>As of writing, this generates a list of 842 different versions available to you. But to install Python version 3.12.6, which is the newest stable version, simply go:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv install 3.12.6
</span></span></code></pre></div><p><code>Pyenv</code> goes ahead and downloads the file and compiles it. You&rsquo;ll have to first install the tools to compile a and build C program, on the Debian family of distros, this package is called <code>build-essential</code>.  After the build has completed, you can take a look at what Python versions are avaible in <code>pyenv</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv versions
</span></span><span style="display:flex;"><span>  * system
</span></span><span style="display:flex;"><span>  3.12.6
</span></span></code></pre></div><p>The one with an asterisk is the currently active version. This is my system version of Python at the moment:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 --version
</span></span><span style="display:flex;"><span>Python 3.11.2
</span></span></code></pre></div><p>To activate the version we just installed, try this:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv shell 3.12.6
</span></span><span style="display:flex;"><span>$ python3 --version
</span></span><span style="display:flex;"><span>Python 3.12.6
</span></span></code></pre></div><p>Now the shell you are running is using Python version 3.12.6. If you open another terminal window, you will still be running the system version, so the <code>shell</code> keyword means that it&rsquo;s only set for that session. There are ways to make version 3.12.6 permanent, using either the <code>local</code> (local to a particular directory) or <code>global</code> (everywhere) keywords. Check out the <code>pyenv</code> documentation for more on this.</p>
<h2 id="next-step-install-plugins"><span class="section-num">3</span> Next step: Install plugins</h2>
<p>Before going further, I recommend that you install a few <code>pyenv</code> plugins. Here are the two most important plugins you&rsquo;ll need to begin with:</p>
<ul>
<li>
<p>Pyenv <a href="https://github.com/pyenv/pyenv-virtualenv.git">virtualenv</a>, enables and manages virtual environments in <code>pyenv</code></p>
</li>
<li>
<p>Pyenv <a href="https://github.com/pyenv/pyenv-update.git">update</a>, updates <code>pyenv</code> and all installed plugins</p>
<p>To install, go to the directory <code>~/.pyenv/plugins</code> and clone the git repos of the plugins you want:</p>
</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ <span style="color:#111">cd</span> ~/.pyenv/plugins
</span></span><span style="display:flex;"><span>$ git clone https://github.com/pyenv/pyenv-virtualenv.git
</span></span><span style="display:flex;"><span>$ git clone https://github.com/pyenv/pyenv-update.git
</span></span></code></pre></div><p>When you have installed these plugins, a few extra commands will be available, <code>pyenv help</code> shows all of them, but the one you&rsquo;ll need now is <code>virtualenv</code>, that creates a Python virtual environment. What is a virtual environment? Very simply put, it is not much more than a separate copy of the <code>site-packages</code> directory, where <code>pip</code> will install all third-party Python packages.</p>
<h2 id="always-use-a-virtual-environment"><span class="section-num">4</span> Always use a virtual environment</h2>
<p>I recommend <em>never</em> install third party packages in your newly created Python directory. I like to keep this version minimal and pristine. Instead, I prefer to create virtual environments based on that version. It&rsquo;s possible to create as many as you want. Many people use a particular virtual environment for a particular project. Or, for example, if you want to play with a Python package that you don&rsquo;t know if you really want, you could create a virtual environment called <code>junk</code> and install the package there. Some Python packages pull in a great number of dependencies, and if you regret, there is no simple way to get rid of those 50 dependencies. But if you isolate your work to a virtual environment, you can use <code>pyenv  virtualenv-delete</code> to get rid of <code>junk</code> again.</p>
<p>So before going any further, I suggest to create a virtual environment based on 3.12.6.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv virtualenv 3.12.6 env-3.12.6
</span></span></code></pre></div><p>Now, change to the new environment:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv shell env-3.12.6
</span></span></code></pre></div><p>Look at what we now have:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv versions
</span></span><span style="display:flex;"><span>  system
</span></span><span style="display:flex;"><span>  3.12.6
</span></span><span style="display:flex;"><span>  3.12.6/envs/env-3.12.6
</span></span><span style="display:flex;"><span>.* env-3.12.6 --&gt; /home/mok/.pyenv/versions/3.12.6/envs/env-3.12.6 <span style="color:#f92672">(</span><span style="color:#111">set</span> by PYENV_VERSION environment variable<span style="color:#f92672">)</span>
</span></span></code></pre></div><p><code>Pyenv</code> lists the new virtual environment twice for some reason, but there only is one. The files are in this directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ls -F ~/.pyenv/versions
</span></span><span style="display:flex;"><span>3.12.6/  env-3.12.6@
</span></span></code></pre></div><p>Now you can go ahead and install all the packages you need with <code>pip</code>, and they will go into the virtual environment called <code>env-3.12.6</code> (or whatever name you give it):</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pip install numpy
</span></span></code></pre></div><h2 id="updating-your-installation"><span class="section-num">5</span> Updating your installation</h2>
<p>After a while, new Python version appear, but they will not be shown by your <code>pyenv</code> unless you update it (in reality, pull from the <code>pyenv</code> git repo). Here, the <code>update</code> plugin we installed above comes in handy. All you need to do at regular intervals is to:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv update
</span></span><span style="display:flex;"><span>pyenv update
</span></span><span style="display:flex;"><span>Updating /home/mok/.pyenv...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 128, <span style="color:#00a8c8">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>107/107<span style="color:#f92672">)</span>, <span style="color:#00a8c8">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>12/12<span style="color:#f92672">)</span>, <span style="color:#00a8c8">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">25</span> <span style="color:#f92672">(</span>delta 15<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">21</span> <span style="color:#f92672">(</span>delta 11<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>from 0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Unpacking objects: 100% <span style="color:#f92672">(</span>25/25<span style="color:#f92672">)</span>, 4.85 KiB <span style="color:#111">|</span> 236.00 KiB/s, <span style="color:#00a8c8">done</span>.
</span></span><span style="display:flex;"><span>From https://github.com/pyenv/pyenv
</span></span><span style="display:flex;"><span> * branch              master     -&gt; FETCH_HEAD
</span></span><span style="display:flex;"><span> * <span style="color:#f92672">[</span>new tag<span style="color:#f92672">]</span>           v2.4.14    -&gt; v2.4.14
</span></span><span style="display:flex;"><span>   3f2ef9e0..468dc811  master     -&gt; origin/master
</span></span><span style="display:flex;"><span>Updating 3f2ef9e0..468dc811
</span></span><span style="display:flex;"><span>Fast-forward
</span></span><span style="display:flex;"><span> .github/workflows/modified_scripts_build.yml                     <span style="color:#111">|</span> <span style="color:#ae81ff">3</span> +--
</span></span><span style="display:flex;"><span> CHANGELOG.md                                                     <span style="color:#111">|</span> <span style="color:#ae81ff">4</span> ++++
</span></span><span style="display:flex;"><span> libexec/pyenv---version                                          <span style="color:#111">|</span> <span style="color:#ae81ff">2</span> +-
</span></span><span style="display:flex;"><span> plugins/python-build/share/python-build/3.12.7                   <span style="color:#111">|</span> <span style="color:#ae81ff">9</span> +++++++++
</span></span><span style="display:flex;"><span> plugins/python-build/share/python-build/3.13.0rc2t               <span style="color:#111">|</span> <span style="color:#ae81ff">2</span> --
</span></span><span style="display:flex;"><span> plugins/python-build/share/python-build/<span style="color:#f92672">{</span>3.13.0rc2 <span style="color:#f92672">=</span>&gt; 3.13.0rc3<span style="color:#f92672">}</span> <span style="color:#111">|</span> <span style="color:#ae81ff">4</span> ++--
</span></span><span style="display:flex;"><span> plugins/python-build/share/python-build/3.13.0rc3t               <span style="color:#111">|</span> <span style="color:#ae81ff">2</span> ++
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">7</span> files changed, <span style="color:#ae81ff">19</span> insertions<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>, <span style="color:#ae81ff">7</span> deletions<span style="color:#f92672">(</span>-<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> create mode <span style="color:#ae81ff">100644</span> plugins/python-build/share/python-build/3.12.7
</span></span><span style="display:flex;"><span> delete mode <span style="color:#ae81ff">100644</span> plugins/python-build/share/python-build/3.13.0rc2t
</span></span><span style="display:flex;"><span> rename plugins/python-build/share/python-build/<span style="color:#f92672">{</span>3.13.0rc2 <span style="color:#f92672">=</span>&gt; 3.13.0rc3<span style="color:#f92672">}</span> <span style="color:#f92672">(</span>59%<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> create mode <span style="color:#ae81ff">100644</span> plugins/python-build/share/python-build/3.13.0rc3t
</span></span><span style="display:flex;"><span>Updating /home/mok/.pyenv/plugins/pyenv-doctor...
</span></span><span style="display:flex;"><span>From https://github.com/pyenv/pyenv-doctor
</span></span><span style="display:flex;"><span> * branch            master     -&gt; FETCH_HEAD
</span></span><span style="display:flex;"><span>Already up to date.
</span></span><span style="display:flex;"><span>Updating /home/mok/.pyenv/plugins/pyenv-pip-migrate...
</span></span><span style="display:flex;"><span>From https://github.com/pyenv/pyenv-pip-migrate
</span></span><span style="display:flex;"><span> * branch            master     -&gt; FETCH_HEAD
</span></span><span style="display:flex;"><span>Already up to date.
</span></span><span style="display:flex;"><span>Updating /home/mok/.pyenv/plugins/pyenv-update...
</span></span><span style="display:flex;"><span>From https://github.com/pyenv/pyenv-update
</span></span><span style="display:flex;"><span> * branch            master     -&gt; FETCH_HEAD
</span></span><span style="display:flex;"><span>Already up to date.
</span></span><span style="display:flex;"><span>Updating /home/mok/.pyenv/plugins/pyenv-virtualenv...
</span></span><span style="display:flex;"><span>From https://github.com/pyenv/pyenv-virtualenv
</span></span><span style="display:flex;"><span> * branch            master     -&gt; FETCH_HEAD
</span></span><span style="display:flex;"><span>Already up to date.
</span></span></code></pre></div><p>Notice that there are already updates to <code>pyenv</code> even though I just did an update a few hours ago in preparation for this posting.</p>
<h2 id="migrate-your-set-of-packages"><span class="section-num">6</span> Migrate your set of packages</h2>
<p>You can keep your virtual environments around; I prefer to use the same virtual environment everywhere until i decide to upgrade to a new Python version. So for a while, I wil be using <code>env-3.12.6</code>. But eventually, I will want to use a newer version of Python, and that is where the <code>pyenv-pip-migrate</code> plugin is really handy. It lets you copy all installed packages from one virtual environment to another. You can find the <code>migrate</code> plugin <a href="https://github.com/pyenv/pyenv-pip-migrate.git">here</a>, just clone it using <code>git</code> like we did above.</p>
<p>So say I wanted to try out the new Python version 3.13.0rc3. I would compile and install the Python binary like before, create a virtual environment, and then migrate all my <code>pip</code> installed packages like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pyenv migrate env-3.12.6 env-3.13.0rc3
</span></span></code></pre></div><p>When in the new environment, I might update the most important packages with a script that calls <code>pip</code> like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#! /bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#111">PACKAGES</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;ipython pandas numpy scipy seaborn matplotlib pillow
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">SQLAlchemy pyarrow pytz pytest openpyxl loguru jupyter jupyterlab
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">beautifulsoup4 colored yamllib&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">for</span> p in <span style="color:#111">$PACKAGES</span><span style="color:#111">;</span> <span style="color:#00a8c8">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">echo</span> Upgrading: <span style="color:#111">$p</span>
</span></span><span style="display:flex;"><span>    pip --quiet install --upgrade <span style="color:#111">$p</span>
</span></span><span style="display:flex;"><span><span style="color:#00a8c8">done</span>
</span></span></code></pre></div><hr>

  </div> 

  <div class="article__tags"><a class="article__tag" href="/tags/emacs">#emacs </a><a class="article__tag" href="/tags/org-mode">#org-mode </a>
  </div> 
</main> 

        </div><footer data-theme="dark" >
  <span id="footer__title">
    © Morten Kjeldgaard, 2024
  </span>
</footer>
<script src="https://kit.fontawesome.com/e55e3b2e7b.js" crossorigin="anonymous"></script>
<script src="/js/main.js"></script>
</body>
</html>
