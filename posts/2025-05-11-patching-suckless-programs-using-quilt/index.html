<!DOCTYPE html>
<html data-theme="light"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta name="description" content="System to patch suckless programs using quilt">
    <meta name="keywords" content="suckless, quilt, python">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
    <link href="/css/main.css" rel="stylesheet"/>
    <title>Patching suckless programs using Quilt ~ MOK&#39;s Onomatomaniske Kaos</title>
</head>
<body><header data-theme="dark" >
  <span id="header__title">
    MOK&#39;s Onomatomaniske Kaos
  </span>
  <div id="header__subtitle">
        Super Cool
  </div><nav class="site-nav">
  <ul class="main-menu">
    
    <li>
      <a href="/"  data-theme="dark" class="contrast">Home</a>
    </li>
    
    <li>
      <a href="/posts"  data-theme="dark" class="contrast">Posts</a>
    </li>
    
    <li>
      <a href="/about"  data-theme="dark" class="contrast">About</a>
    </li>
    
  </ul>
</nav>
</header>
<div id="content">
<main class=container>
  <div class="grid">
    <div class="article__title">
      <h2>Patching suckless programs using Quilt</h2>
    </div>

    <div class="article__categories"><span><i class="fa fa-list"></i></span>
      <a class="article__category" href="/categories/linux">Linux</a>
    </div> 

  </div> 

  
    <div class="article__date">2025-05-11 20:39</div>
  
  <div class="article__author">Morten Kjeldgaard</div>

  <hr />
  <div class="content">
    <p>I created a system to patch suckless programs using <code>GNU quilt</code>. When building suckless programs from source I found that dealing with the patches was confusing and error prone. I therefore made a tool to make looking at patches systematic and reproducible by making use of <code>quilt</code>. This tool is used by Debian for patching source packages which is why I know about it.</p>
<p>The advantage of using <code>quilt</code> is that you can always reverse the patches and get back to a blank slate, which means you can do <code>git pull</code> from the upstream repo and then reapply your patches.</p>
<p>I have written a small Python script that reads a YAML file with the definitions of what patches you want and where to find them, and what priority they have. It&rsquo;s a very simple system that creates a patches directory in the suckless build directory and copies the patches there following a naming scheme that decides in what order patches will be applied.</p>
<p>The git repo is <a href="https://codeberg.org/mok0/suckless-patches">here on codeberg</a> and there&rsquo;s a tutorial that mainly shows how to use <code>quilt</code>. You will notice that the writeup there is pretty much exactly the same as this blog post ðŸ˜¬</p>
<h2 id="introduction"><span class="section-num">1</span> Introduction</h2>
<p>The Python script named <code>suckless-patches.py</code> can help you download suckless patches and prepare them to be applied using <a href="https://savannah.nongnu.org/projects/quilt/quilt/">GNU quilt</a> system, that <em>&ldquo;allows you to easily manage large numbers of patches by keeping track of the changes each patch makes. Patches can be applied, un-applied, refreshed, and more.&rdquo;</em>. The <code>quilt</code> manpage can be seen <a href="https://linux.die.net/man/1/quilt">here</a>.</p>
<p>In this tutorial, we shall apply patches to the simple terminal <code>st</code>, but the system works as well for <code>dwm</code> and more. For each program you wish to patch, create a file in yaml format that specifies the patches you want. Here is our example file <code>st-patches.yaml</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>builddir: ~/Build/st
</span></span><span style="display:flex;"><span>url: https://st.suckless.org/patches/
</span></span><span style="display:flex;"><span>patches:
</span></span><span style="display:flex;"><span>  scrollback:
</span></span><span style="display:flex;"><span>    patch: st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>    priority: <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span>  fullscreen:
</span></span><span style="display:flex;"><span>    patch: st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>    priority: <span style="color:#ae81ff">10</span>
</span></span></code></pre></div><p>The field <code>builddir</code> defines where you have cloned the git repo (or unpacked the <code>tar.gz</code> file). The field <code>url</code> specifies the base network location of the patches. These are defined in the <code>patches</code> dictionary. The name of the patch (e.g. &ldquo;scrollback&rdquo;) is the component of the url that you find on <a href="https://st.suckless.org/patches">https://st.suckless.org/patches</a> and the <code>patch</code> field is the filename in the url. The number in <code>priority</code> is rather important, it will translate to the order in which the patches are applied. When the patch is saved to a file, this zero padded, three digit number will be prepended to the patch name.</p>
<p>Note: If a patch has a different URL than the base URL at the top of the file, you can define a &ldquo;local&rdquo; one for a single patch, using the key <code>url</code>.</p>
<h2 id="downloading-the-patches"><span class="section-num">2</span> Downloading the patches</h2>
<p>We have two patches for <code>st</code> defined in the YAML file, one for fullscreen and one for scrollback.</p>
<p>Now let <code>suckless-patches.py</code> do it&rsquo;s thing. It will create a directory named <code>patches</code> in your build directory, and copy the downloaded patches to there, following the naming scheme mentioned above. The script is idempotent, meaning if the patch is already there it won&rsquo;t do anything, except create a new <code>series</code> file, but more about that later.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 suckless-patches.py st-patches.yaml
</span></span><span style="display:flex;"><span>2025-05-11 17:58 <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> Created directory /home/mok/Build/st/patches
</span></span><span style="display:flex;"><span>2025-05-11 17:58 <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> Downloaded patch: st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>2025-05-11 17:58 <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> Downloaded patch: st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>2025-05-11 17:58 <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> Adding patch 010-st-fullscreen-0.8.5.diff to series
</span></span><span style="display:flex;"><span>2025-05-11 17:58 <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> Adding patch 040-st-scrollback-0.9.2.diff to series
</span></span></code></pre></div><p>When <code>suckless-patches.py</code> has downloaded the files defined in the yaml config file, it will find all <code>*.diff</code> files in the <code>patches</code> directory, sort them according to their priority number, and write them to the file <code>series</code>, which simply lists what patch files <code>quilt</code> should apply and in what order. The <code>series</code> file will be overwritten every time you run <code>suckless-patches.py</code>, but it will include any patches you drop in the patch directory so it shouldn&rsquo;t be a problem.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt init
</span></span><span style="display:flex;"><span>The quilt meta-data is now initialized.
</span></span></code></pre></div><p>This command has created a bookkeeping directory for <code>quilt</code> called <code>.pc</code>. Specifically check if the file <code>.pc/.quilt-patches</code> contains the name of the patches directory. What is written in there depends on the environmental variable <code>QUILT_PATCHES</code>, which may or may not be set in <code>/etc/quilt.quiltrc</code> or <code>~/.quiltrc</code>.</p>
<h2 id="pushing-the-first-patch"><span class="section-num">3</span> Pushing the first patch</h2>
<p>Now we push the first patch:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt push
</span></span><span style="display:flex;"><span>Applying patch 010-st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>patching file config.def.h
</span></span><span style="display:flex;"><span>patching file st.h
</span></span><span style="display:flex;"><span>patching file x.c
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#2 succeeded at 761 (offset 16 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#3 succeeded at 1246 (offset 19 lines).</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Now at patch 010-st-fullscreen-0.8.5.diff
</span></span></code></pre></div><p>That went well, the patch applied fine. However, there was a bit of line offset, lets fix that by refreshing the patch:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt refresh
</span></span><span style="display:flex;"><span>Warning: trailing whitespace in line <span style="color:#ae81ff">770</span> of x.c
</span></span><span style="display:flex;"><span>Refreshed patch 010-st-fullscreen-0.8.5.diff
</span></span></code></pre></div><p>There was a bit of trailing whitespace in <code>x.c</code>, let&rsquo;s fix that by editing the file:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt edit x.c
</span></span><span style="display:flex;"><span>File x.c is already in patch 010-st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>Waiting <span style="color:#00a8c8">for</span> Emacs...
</span></span></code></pre></div><p><code>Quilt</code> invokes whatever editer is defined in <code>EDITOR</code> environmental variable.  Now refresh the patch again:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt refresh
</span></span><span style="display:flex;"><span>Refreshed patch 010-st-fullscreen-0.8.5.diff
</span></span></code></pre></div><p>At this point the patch is <strong>different from the patch we downloaded</strong> because we have made modifications to what it&rsquo;s doing.</p>
<h2 id="pushing-the-second-patch"><span class="section-num">4</span> Pushing the second patch</h2>
<p>Now we continue to the next patch, the one called <code>040-st-scrollback-0.9.2.diff</code>. Every time we use <code>quilt push</code> it advances to the next patch in the stack and applies it, but only if successful.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt push
</span></span><span style="display:flex;"><span>Applying patch 040-st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>patching file config.def.h
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#1 FAILED at 201.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> out of <span style="color:#ae81ff">1</span> hunk FAILED -- rejects in file config.def.h
</span></span><span style="display:flex;"><span>patching file st.c
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#15 succeeded at 1350 (offset 3 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#16 succeeded at 1795 (offset 3 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#17 succeeded at 2375 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#18 succeeded at 2388 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#19 succeeded at 2611 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#20 succeeded at 2648 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#21 succeeded at 2714 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#22 succeeded at 2735 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>patching file st.h
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#1 FAILED at 81.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> out of <span style="color:#ae81ff">1</span> hunk FAILED -- rejects in file st.h
</span></span><span style="display:flex;"><span>Patch 040-st-scrollback-0.9.2.diff does not apply <span style="color:#f92672">(</span>enforce with -f<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>So we see there were rejections, and because of this, <code>quilt</code> has not applied it:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt top
</span></span><span style="display:flex;"><span>010-st-fullscreen-0.8.5.diff
</span></span></code></pre></div><p>The fullscreen patch is still at the top of the stack. So let&rsquo;s force the scrollback patch, so we get some reject files:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt push -f
</span></span><span style="display:flex;"><span>Applying patch 040-st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>patching file config.def.h
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#1 FAILED at 201.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> out of <span style="color:#ae81ff">1</span> hunk FAILED -- saving rejects to file config.def.h.rej
</span></span><span style="display:flex;"><span>patching file st.c
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#15 succeeded at 1350 (offset 3 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#16 succeeded at 1795 (offset 3 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#17 succeeded at 2375 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#18 succeeded at 2388 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#19 succeeded at 2611 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#20 succeeded at 2648 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#21 succeeded at 2714 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#22 succeeded at 2735 (offset 7 lines).</span>
</span></span><span style="display:flex;"><span>patching file st.h
</span></span><span style="display:flex;"><span>Hunk <span style="color:#75715e">#1 FAILED at 81.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> out of <span style="color:#ae81ff">1</span> hunk FAILED -- saving rejects to file st.h.rej
</span></span><span style="display:flex;"><span>Applied patch 040-st-scrollback-0.9.2.diff <span style="color:#f92672">(</span>forced<span style="color:#111">;</span> needs refresh<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Now we have two reject files, <code>config.def.h.rej</code> and <code>st.h.rej</code>. These patches have been rejected because they want to modify code segments that were already modified by our first patch, <code>010-st-fullscreen-0.8.5.diff</code>.</p>
<p>Here is the first reject, <code>config.def.h.rej</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>--- config.def.h
</span></span><span style="display:flex;"><span>+++ config.def.h
</span></span><span style="display:flex;"><span>@@ -201,6 +201,8 @@ static Shortcut shortcuts[] = {
</span></span><span style="display:flex;"><span>        { TERMMOD,              XK_Y,           selpaste,       {.i =  0} },
</span></span><span style="display:flex;"><span>        { ShiftMask,            XK_Insert,      selpaste,       {.i =  0} },
</span></span><span style="display:flex;"><span>        { TERMMOD,              XK_Num_Lock,    numlock,        {.i =  0} },
</span></span><span style="display:flex;"><span>+       { ShiftMask,            XK_Page_Up,     kscrollup,      {.i = -1} },
</span></span><span style="display:flex;"><span>+    { ShiftMask,            XK_Page_Down,   kscrolldown,    {.i = -1} },
</span></span><span style="display:flex;"><span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> /*
</span></span></code></pre></div><p>There is a couple of lines that <code>quilt</code> couldn&rsquo;t place, so we add those two lines manually by editing the file. The two lines with <code>ShiftMask</code> couldn&rsquo;t be inserted because those lines were modified by the fullscreen patch. The next reject file, <code>st.h.rej</code> looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>--- st.h
</span></span><span style="display:flex;"><span>+++ st.h
</span></span><span style="display:flex;"><span>@@ -81,6 +81,8 @@ void die(const char *, ...);
</span></span><span style="display:flex;"><span> void redraw(void);
</span></span><span style="display:flex;"><span> void draw(void);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+void kscrolldown(const Arg *);
</span></span><span style="display:flex;"><span>+void kscrollup(const Arg *);
</span></span><span style="display:flex;"><span> void printscreen(const Arg *);
</span></span><span style="display:flex;"><span> void printsel(const Arg *);
</span></span><span style="display:flex;"><span> void sendbreak(const Arg *);
</span></span></code></pre></div><p>This is two function declaration that we need to put in <code>st.h</code>, right around line 81. It&rsquo;s the same problem again, these lines were changed by the fullscreen patch.</p>
<p>So with all problems solved, let&rsquo;s refresh the patch so it will work from now on:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt refresh
</span></span><span style="display:flex;"><span>Refreshed patch 040-st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ quilt top
</span></span><span style="display:flex;"><span>040-st-scrollback-0.9.2.diff
</span></span></code></pre></div><p>The patch was refreshed (meaning it reflects the changes we made) and it&rsquo;s now on top of the stack. So let&rsquo;s pop off all patches using the <code>quilt pop -a</code> command, to go back to where no patches were applied:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt pop -a
</span></span><span style="display:flex;"><span>Removing patch 040-st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>Restoring st.h
</span></span><span style="display:flex;"><span>Restoring st.c
</span></span><span style="display:flex;"><span>Restoring config.def.h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Removing patch 010-st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>Restoring x.c
</span></span><span style="display:flex;"><span>Restoring st.h
</span></span><span style="display:flex;"><span>Restoring config.def.h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No patches applied
</span></span></code></pre></div><p>At this point <strong>no patches are applied</strong>, if you cloned the git repo you can now check that the files are pristine (except for a bunch of untracked files). Now applying all patches should go without problems:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt push -a
</span></span><span style="display:flex;"><span>Applying patch 010-st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>patching file config.def.h
</span></span><span style="display:flex;"><span>patching file st.h
</span></span><span style="display:flex;"><span>patching file x.c
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Applying patch 040-st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>patching file config.def.h
</span></span><span style="display:flex;"><span>patching file st.c
</span></span><span style="display:flex;"><span>patching file st.h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Now at patch 040-st-scrollback-0.9.2.diff
</span></span></code></pre></div><p>Both patches now work, time to see if <code>st</code> compiles:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rm config.h
</span></span><span style="display:flex;"><span>$ make clean st
</span></span><span style="display:flex;"><span>rm -f st st.o x.o st-0.9.2.tar.gz
</span></span><span style="display:flex;"><span>cp config.def.h config.h
</span></span><span style="display:flex;"><span>c99 -I/usr/X11R6/include  <span style="color:#d88200">`</span>pkg-config --cflags fontconfig<span style="color:#d88200">`</span>  <span style="color:#d88200">`</span>pkg-config --cflags freetype2<span style="color:#d88200">`</span> -DVERSION<span style="color:#f92672">=</span><span style="color:#8045ff">\&#34;</span>0.9.2<span style="color:#8045ff">\&#34;</span> -D_XOPEN_SOURCE<span style="color:#f92672">=</span><span style="color:#ae81ff">600</span>  -O1 -c st.c
</span></span><span style="display:flex;"><span>c99 -I/usr/X11R6/include  <span style="color:#d88200">`</span>pkg-config --cflags fontconfig<span style="color:#d88200">`</span>  <span style="color:#d88200">`</span>pkg-config --cflags freetype2<span style="color:#d88200">`</span> -DVERSION<span style="color:#f92672">=</span><span style="color:#8045ff">\&#34;</span>0.9.2<span style="color:#8045ff">\&#34;</span> -D_XOPEN_SOURCE<span style="color:#f92672">=</span><span style="color:#ae81ff">600</span>  -O1 -c x.c
</span></span><span style="display:flex;"><span>c99 -o st st.o x.o -L/usr/X11R6/lib -lm -lrt -lX11 -lutil -lXft  <span style="color:#d88200">`</span>pkg-config --libs fontconfig<span style="color:#d88200">`</span>  <span style="color:#d88200">`</span>pkg-config --libs freetype2<span style="color:#d88200">`</span>
</span></span></code></pre></div><p>The build completed! Cool!</p>
<h2 id="adding-a-couple-of-homemade-patches"><span class="section-num">5</span> Adding a couple of homemade patches</h2>
<p>Now let&rsquo;s change the font, it&rsquo;s too small for me, and it&rsquo;s not my favorite font. I will add a new home made patch to do this:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt new 000-font.diff
</span></span><span style="display:flex;"><span>Patch 000-font.diff is now on top
</span></span></code></pre></div><p>OBS: The file names <strong>must have the suffix</strong> <code>.diff</code>.</p>
<p>We also have to <strong>add</strong> a file to this patch. This is important! While <code>quilt</code> is a very useful tool, it does not do a lot of handholding. The reason you have to add files to the patch is so <code>quilt</code> can stash away pristine copies of it for its bookkeeping, and simply to be able to create the diffs.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt add config.def.h
</span></span><span style="display:flex;"><span>File config.def.h added to patch 000-font.diff
</span></span></code></pre></div><p>The font definition is found in the file <code>config.def.h</code>, that&rsquo;s why I added that one. Now I will edit it and introduce my favorite font:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt edit config.def.h
</span></span></code></pre></div><p>So, edit, edit, edit, and refresh the patch:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt refresh
</span></span><span style="display:flex;"><span>Refreshed patch 000-font.diff
</span></span></code></pre></div><p>And this is what the diff looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>--- a/config.def.h
</span></span><span style="display:flex;"><span>+++ b/config.def.h
</span></span><span style="display:flex;"><span>@@ -5,7 +5,7 @@
</span></span><span style="display:flex;"><span>  *
</span></span><span style="display:flex;"><span>  * font: see http://freedesktop.org/software/fontconfig/fontconfig-user.html
</span></span><span style="display:flex;"><span>  */
</span></span><span style="display:flex;"><span>-static char *font = &#34;Liberation Mono:pixelsize=12:antialias=true:autohint=true
</span></span><span style="display:flex;"><span>&#34;;
</span></span><span style="display:flex;"><span>+static char *font = &#34;Monaspace Neon:pixelsize=14:antialias=true:autohint=true&#34;
</span></span><span style="display:flex;"><span> static int borderpx = 2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> /*
</span></span></code></pre></div><h3 id="changing-the-makefile">Changing the Makefile</h3>
<p>I find that with suckless programs I always have to delete <code>config.h</code> after applying new patches, so I want to modify the <code>Makefile</code> to do that automatically.</p>
<p>Let&rsquo;s create a new patch, and add <code>Makefile</code> to it:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt new 000-makefile.diff
</span></span><span style="display:flex;"><span>Patch 000-makefile.diff is now on top
</span></span><span style="display:flex;"><span>$ quilt add Makefile
</span></span><span style="display:flex;"><span>File Makefile added to patch 000-makefile.diff
</span></span></code></pre></div><p>Now, edit, edit, edit, and refresh the patch, and cat it to review:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt refresh
</span></span><span style="display:flex;"><span>Refreshed patch 000-makefile.diff
</span></span></code></pre></div><p>and this is the new patch:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>$ cat patches/000-makefile.diff
</span></span><span style="display:flex;"><span>--- a/Makefile
</span></span><span style="display:flex;"><span>+++ b/Makefile
</span></span><span style="display:flex;"><span>@@ -24,7 +24,7 @@
</span></span><span style="display:flex;"><span>$(CC) -o $@ $(OBJ) $(STLDFLAGS)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clean:
</span></span><span style="display:flex;"><span>-       rm -f st $(OBJ) st-$(VERSION).tar.gz
</span></span><span style="display:flex;"><span>+       rm -f st $(OBJ) st-$(VERSION).tar.gz config.h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dist: clean
</span></span><span style="display:flex;"><span>mkdir -p st-$(VERSION)
</span></span></code></pre></div><p>That looks good, I simply added <code>config.h</code> to the <code>clean</code> target. This file is generated from <code>config.def.h</code> if it&rsquo;s not there, so it should never be a problem.</p>
<p>Let&rsquo;s look at out patch stack:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ quilt  series
</span></span><span style="display:flex;"><span>010-st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>040-st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>000-font.diff
</span></span><span style="display:flex;"><span>000-makefile.diff
</span></span></code></pre></div><p>Everything looks good! I can now pop off all patches (<code>quilt pop -a</code>) and push them all again (<code>quilt push -a</code>). This is what&rsquo;s in the <code>patches</code> directory. You can drop your own patches in there and add them to the <code>series</code> file. You don&rsquo;t need to use <code>suckless-patches.py</code> you can download directly from the suckless site, but having the YAML file gives you a compact, reproducible recipe, so that is the advantage. But in any case, every time you drop in a new patch, pop off all patches first just to be safe.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tree patches
</span></span><span style="display:flex;"><span>patches
</span></span><span style="display:flex;"><span>â”œâ”€â”€ 000-font.diff
</span></span><span style="display:flex;"><span>â”œâ”€â”€ 000-makefile.diff
</span></span><span style="display:flex;"><span>â”œâ”€â”€ 010-st-fullscreen-0.8.5.diff
</span></span><span style="display:flex;"><span>â”œâ”€â”€ 040-st-scrollback-0.9.2.diff
</span></span><span style="display:flex;"><span>â””â”€â”€ series
</span></span></code></pre></div><p>You will notice that the homemade patches <code>000-*</code> are listed last in the series file. This is how <code>quilt</code> does it, however, if you add another patch to the YAML file and use <code>suckless-patches.py</code> again, it will create a new <code>series</code> file with all patches in numerical order. The <em>might</em> create problems for you if you are making local edits in the same file that the official patches want to modify, so beware of this.</p>
<p>If a patch causes problems, pop all patches off and move it to the first position of in <code>patches/series</code> or simply edit the <code>series</code> file to only contain the one problematic patch. But be careful always to make sure what patches in the stack have been applied. The best in my experience is to always start from a &ldquo;clean slate&rdquo;, meaning pop off all patches before you start to mess with one.</p>
<h2 id="conclusion"><span class="section-num">6</span> Conclusion</h2>
<p><code>Quilt</code> provides a systematic and reproducible way to deal with patches. This is one reason that it is used by Debian to manage patches in source packages.</p>
<p>One advantage you will notice is if you need to pull updates to the software from git. You can simply pop off all patches, do a <code>git pull origin master</code>, and reapply the patches one by one, solving any problems as you go along.</p>
<hr>

  </div> 

  <div class="article__tags"><a class="article__tag" href="/tags/python">#python </a><a class="article__tag" href="/tags/quilt">#quilt </a><a class="article__tag" href="/tags/suckless">#suckless </a><a class="article__tag" href="/tags/dwm">#dwm </a>
  </div> 
</main> 

        </div><footer data-theme="dark" >
  <span id="footer__title">
    Â© Morten Kjeldgaard, 2025
  </span>
</footer>
<script src="https://kit.fontawesome.com/e55e3b2e7b.js" crossorigin="anonymous"></script>
<script src="/js/main.js"></script>
</body>
</html>
