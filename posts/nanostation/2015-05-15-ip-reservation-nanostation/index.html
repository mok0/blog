<!DOCTYPE html>
<html data-theme="light"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
    <link href="/css/main.css" rel="stylesheet"/>
    <title>Reservation of IP address on Nanostation M5 ~ MOK&#39;s Onomatomaniske Kaos</title>
</head>
<body><header>
  <span id="header-title">
    MOK&#39;s Onomatomaniske Kaos
  </span>
  <div id="header-subtitle">
        Super Cool
  </div><nav class="site-nav">
  <ul class="main-menu">
    
    <li>
      <a href="/blog/">Home</a>
    </li>
    
    <li>
      <a href="/blog/posts">Posts</a>
    </li>
    
    <li>
      <a href="/blog/about">About</a>
    </li>
    
    <li>
      <a href="/blog/contacts">Contact</a>
    </li>
    
  </ul>
</nav>
</header>
<div id="content">
<div class="container">
  <article>

    <div class="grid">

      <div class="homepage_article__title">
        <h2>Reservation of IP address on Nanostation M5</h2>
      </div>

      <div class="article-categories"><span><i class="fa fa-list"></i></span>
            <a class="article-category" href="/categories/nanostation">nanostation</a>
      </div>

    </div>
    
      <div class="homepage-article__date">2015-05-15 12:30</div>
    
    <div class="homepage-article__author">[Morten Kjeldgaard]</div>

    <hr />
    <div class="content">
      <blockquote>
<p>Note: From AirOS version 5.6.9 and forward, the following is no
longer necessary, because you can reserve IP addresses directly from
the Nanostation&rsquo;s web interface. 2017-01-11.</p>
</blockquote>
<p>The Nanostation M5 from <a href="https://www.ubnt.com/">Ubiquity</a> has a
comprehensive and beautiful web GUI interface that enables
customization of a large number of settings. Unfortunately,
reservation of IP addresses for specific hosts on the local network in
the Nanostation&rsquo;s DHCP server is not possible via the GUI. This is a
bit strange, because the GUI does allow port-forwarding, an option
which is a bit useless without the possibility to reserve an IP
address on the LAN to forward traffic to.</p>
<p>Instead, you need to specify the DHCP reservations manually by making
a small change in the Nanostation&rsquo;s operating system. Log on to the
Nanostation from a terminal:</p>
<pre><code>ssh admin@192.168.50.252
</code></pre>
<p>The Nanostation runs a tiny Linux system (&ldquo;AirOS&rdquo;), and many of the
standard UNIX tools are available
via <a href="http://www.busybox.net">busybox</a>.
Fortunately,
<a href="http://wiki.ubnt.com/Manual_Routes">AirOS allows users to add scripts</a> in
the <code>/etc/persistent</code> directory of the Ubiquiti device.</p>
<p>Create a file <code>/etc/persistent/reservations.conf</code> containing the
DHCP reservations:</p>
<pre><code># raspberrypi
dhcp-host=b8:27:eb:d2:7a:da,192.168.50.222
# my-laptop
dhcp-host=5c:96:9d:76:42:29,192.168.50.223
</code></pre>
<p>These statements will ensure that the device with the given Mac
address is given the same IP address every time it joins the network.
In order to prevent that other devices are given these adresses, they
should be chosen outside the range of IP addresses normally handed out
by the DHCP daemon. This range is defined in the Nanostation&rsquo;s web
GUI.</p>
<p>The file <code>/etc/dnsmasq.conf</code> is rewritten every time the Nanostation
boots, taking parameters from the GUI interface, so it is useless to
edit it manually. Create a boot-time script
<code>/etc/persistent/rc.prestart</code>:</p>
<pre><code>RES=/etc/persistent/reservations.conf
if test -r $RES; then
   cat /etc/persistent/reservations.conf &gt;&gt; /etc/dnsmasq.conf
fi
</code></pre>
<p>Do a save:</p>
<pre><code>M.v5.5.10# save
</code></pre>
<p>(The command <code>save</code> is an alias: <code>save='cfgmtd -w -p /etc/'</code>)</p>
<p>Now, you can kill the <code>dnsmasq</code> daemon, it is restarted automatically
by init (it is listed in <code>/var/etc/inittab</code>). You can also reboot the
Nanostation:</p>
<pre><code>M.v5.5.10# reboot
</code></pre>
<p>When the Nanostation is back up, reboot your device or simply renew
the DHCP lease. Below is shown how this is done in Mac OSX 10.10.</p>
<p><img src="/posts/nanostation/2015-05-15-renew-lease.png" alt="Renew DHCP lease, Mac OS X 10.10"></p>

    </div>

    <div class="article__tags">
    </div>
  </article>
</div>

        </div><footer>
  <span id="footer-title">
    Â© Morten Kjeldgaard, 2024
  </span>
</footer>
<script src="https://kit.fontawesome.com/e55e3b2e7b.js" crossorigin="anonymous"></script>
<script src="/js/main.js"></script>
</body>
</html>
