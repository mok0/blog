<!DOCTYPE html>
<html data-theme="light"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>
    <link href="/css/main.css" rel="stylesheet"/>
    <title>Convert Launchpad repos to git ~ MOK&#39;s Onomatomaniske Kaos</title>
</head>
<body><header data-theme="dark" >
  <span id="header__title">
    MOK&#39;s Onomatomaniske Kaos
  </span>
  <div id="header__subtitle">
        Super Cool
  </div><nav class="site-nav">
  <ul class="main-menu">
    
    <li>
      <a href="/"  data-theme="dark" class="contrast">Home</a>
    </li>
    
    <li>
      <a href="/posts"  data-theme="dark" class="contrast">Posts</a>
    </li>
    
    <li>
      <a href="/about"  data-theme="dark" class="contrast">About</a>
    </li>
    
    <li>
      <a href="/contacts"  data-theme="dark" class="contrast">Contact</a>
    </li>
    
  </ul>
</nav>
</header>
<div id="content">
<main class=container>
  <div class="grid">
    <div class="article__title">
      <h2>Convert Launchpad repos to git</h2>
    </div>

    <div class="article__categories"><span><i class="fa fa-list"></i></span>
      <a class="article__category" href="/categories/linux">Linux</a>
    </div> 

  </div> 

  
    <div class="article__date">2021-11-27 00:00</div>
  
  <div class="article__author">Morten Kjeldgaard</div>

  <hr />
  <div class="content">
    <p>This is a short guide on how to convert your Bazaar repos to git on
Launchpad, which is Ubuntu&rsquo;s development server. Bazaar was chosen by
Ubuntu as their revision control system, and the developers did a lot
of work on the Bazaar code, which is written in Python. However,
development stopped several years ago, and Bazaar was no longer
maintained. A spinoff project named <a href="https://github.com/breezy-team/breezy">Breezy</a> took over, and is
maintaining the code, now invoked by the commend <code>brz</code> (but with an
alias to former &lsquo;bzr&rsquo;). Anyway, it&rsquo;s time to convert my archives to
git.</p>
<p>Select &ldquo;git&rdquo; and push &ldquo;Update at the bottom.</p>
<p>You have to make sure you have pulled the latest version of the
Bazaar repo.</p>
<pre><code>bzr pull
</code></pre>
<p>Stash away the <code>repo</code> directory in a tar file:</p>
<pre><code>tar --xz -cvf repo-save.tar.xz repo-dir
</code></pre>
<p>Now initialize the git repo</p>
<pre><code>cd repo-dir
git init .
</code></pre>
<p>Export the bzr repo logs and everything, and import directly into git, using
the fast-import protocol:</p>
<pre><code>bzr fast-export --plain . | git fast-import
git reset --hard
</code></pre>
<p>Now save a copy of the <code>.bzr</code> directory, and perhaps delete it from the repo:</p>
<pre><code>tar -cvJf dot-bzr.tar.xz .bzr
rm -rf .bzr/   # probably not
</code></pre>
<p>You can add a remote for your Git repository with the command:</p>
<pre><code>git remote add origin git+ssh://mok0@git.launchpad.net/mmdb
</code></pre>
<p>&hellip; and finally push the Git branch to Launchpad with:</p>
<pre><code>git push origin master
</code></pre>
<h3 id="note-added-2024-06-27">Note added 2024-06-27</h3>
<p>Today I ran into a problem following the above procedure, which did not seem to work. This is what <code>git</code> told me:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git reset --hard
</span></span><span style="display:flex;"><span>git hist
</span></span><span style="display:flex;"><span>fatal: your current branch <span style="color:#d88200">&#39;main&#39;</span> does not have any commits yet
</span></span></code></pre></div><p>It turns out I had to checkout master, because <code>git</code> now names the main branch <code>main</code> where <code>bzr fast-export</code> named it <code>master</code>. This is because in <code>~/.gitconfig</code> I have have set:</p>
<pre tabindex="0"><code>[init]
        defaultBranch = main
</code></pre><p>which probably many people have done, since &ldquo;master&rdquo; is a poor name.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git checkout master
</span></span><span style="display:flex;"><span>error: The following untracked working tree files would be overwritten by checkout:
</span></span><span style="display:flex;"><span>... &lt;list of files that would be overwritten&gt;
</span></span></code></pre></div><p>I stashed those files away in <code>.tar.gz</code> archive, checked out <code>master</code> and git had all the revisions.</p>
<h4 id="the-right-way-to-do-it">The right way to do it</h4>
<p>After running <code>git init</code>, make sure the archive is on branch <code>master</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git init .
</span></span><span style="display:flex;"><span>$ git checkout -b master
</span></span><span style="display:flex;"><span>Switched to a new branch <span style="color:#d88200">&#39;master&#39;</span>
</span></span></code></pre></div><p>Then proceed to do <code>git fast-import</code>, and <strong>be aware</strong> that any changes not in the <code>bzr</code> branch will be <strong>overwritten</strong> when you do <code>git rest --hard</code>.</p>
  </div> 

  <div class="article__tags"><a class="article__tag" href="/tags/git">#git </a><a class="article__tag" href="/tags/bzr">#bzr </a><a class="article__tag" href="/tags/launchpad">#launchpad </a>
  </div> 
</main> 

        </div><footer data-theme="dark" >
  <span id="footer__title">
    Â© Morten Kjeldgaard, 2024
  </span>
</footer>
<script src="https://kit.fontawesome.com/e55e3b2e7b.js" crossorigin="anonymous"></script>
<script src="/js/main.js"></script>
</body>
</html>
